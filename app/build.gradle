plugins {
    id("com.android.application")
    id("kotlin-android")
    id("kotlin-android-extensions")
    id("kotlin-kapt")
    id("dagger.hilt.android.plugin")
    id("de.mannodermaus.android-junit5")
}

apply(from: "../dependencies.gradle")
apply(from: "../project.gradle")

android {
    compileSdkVersion projectConfig.compileSdkVersion
    buildToolsVersion projectConfig.buildToolsVersion

    defaultConfig {
        applicationId projectConfig.applicationId
        minSdkVersion projectConfig.minSdkVersion
        targetSdkVersion projectConfig.targetSdkVersion
        versionCode projectVersion.major * 10000 + projectVersion.minor * 100 + projectVersion.minor
        versionName "${projectVersion.major}.${projectVersion.minor}.${projectVersion.patch}"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            testCoverageEnabled = false
        }

        debug {
            testCoverageEnabled = true
        }
    }

    buildFeatures {
        viewBinding = true
        compose = true
    }

    composeOptions {
        kotlinCompilerVersion = "1.4.0"
        kotlinCompilerExtensionVersion = "1.0.0-alpha03"
    }

    androidExtensions {
        experimental = true
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = JavaVersion.VERSION_1_8.toString()
        freeCompilerArgs += ["-Xallow-jvm-ir-dependencies", "-Xskip-prerelease-check"]
        useIR = true
    }

    testOptions {
        unitTests.returnDefaultValues = true
        unitTests.all {
            jacoco {
                includeNoLocationClasses = true
            }
        }
    }
}

kapt {
    correctErrorTypes = true
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    implementation project(":domain")
    implementation project(":data")

    implementation projectDependencies.kotlinStdlib
    implementation projectDependencies.kotlinReflect
    implementation projectDependencies.materialDesign
    implementation projectDependencies.appCompat
    implementation projectDependencies.fragment
    implementation projectDependencies.navigationFragment
    implementation projectDependencies.navigationUI
    implementation projectDependencies.rxJava
    implementation projectDependencies.rxAndroid
    implementation projectDependencies.lifecycleCommon
    implementation projectDependencies.timber
    implementation projectDependencies.coil
    implementation projectDependencies.retrofitRxAdapter
    implementation projectDependencies.moshi
    implementation projectDependencies.hilt
    implementation projectDependencies.hiltAndroid

    implementation "androidx.compose.ui:ui:1.0.0-alpha03"
    implementation "androidx.compose.material:material:1.0.0-alpha03"
    implementation "androidx.compose.material:material-icons-extended:1.0.0-alpha03"
    implementation "androidx.compose.foundation:foundation:1.0.0-alpha03"
    implementation "androidx.compose.foundation:foundation-layout:1.0.0-alpha03"
    implementation "androidx.compose.animation:animation:1.0.0-alpha03"
    implementation "androidx.compose.runtime:runtime:1.0.0-alpha03"
    implementation "androidx.compose.runtime:runtime-livedata:1.0.0-alpha03"
    implementation "androidx.ui:ui-tooling:1.0.0-alpha03"

    kapt projectDependencies.hiltCompiler
    kapt projectDependencies.hiltAndroidCompiler

    testImplementation testDependencies.androidTestCore
    testImplementation testDependencies.mockk
    testImplementation testDependencies.junitAPI
    testRuntimeOnly testDependencies.junitEngine
}
